!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-loaders",["babylonjs"],t):"object"==typeof exports?exports["babylonjs-loaders"]=t(require("babylonjs")):n.LOADERS=t(n.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,function(n){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var i={};return t.m=n,t.c=i,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:r})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,i){var r,u;if((1&i&&(n=t(n)),8&i)||4&i&&"object"==typeof n&&n&&n.__esModule)return n;if(r=Object.create(null),t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&i&&"string"!=typeof n)for(u in n)t.d(r,u,function(t){return n[t]}.bind(null,u));return r},t.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=16)}([function(t){t.exports=n},function(n,t,i){"use strict";i.d(t,"a",function(){return u});i.d(t,"b",function(){return e});var r=i(0),f=i(2),u=function(){function n(){}return n.Get=function(n,t,i){if(!t||null==i||!t[i])throw new Error(n+": Failed to find index ("+i+")");return t[i]},n.Assign=function(n){if(n)for(var t=0;t<n.length;t++)n[t].index=t},n}(),e=function(){function n(n){this._completePromises=[];this._disposed=!1;this._state=null;this._extensions={};this._defaultBabylonMaterialData={};this._requests=[];this._parent=n}return n.RegisterExtension=function(t,i){n.UnregisterExtension(t)&&r.Tools.Warn("Extension with the name '"+t+"' already exists");n._ExtensionFactories[t]=i;n._ExtensionNames.push(t)},n.UnregisterExtension=function(t){if(!n._ExtensionFactories[t])return!1;delete n._ExtensionFactories[t];var i=n._ExtensionNames.indexOf(t);return-1!==i&&n._ExtensionNames.splice(i,1),!0},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gltf",{get:function(){return this._gltf},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var n,t,i;if(!this._disposed){for(this._disposed=!0,n=0,t=this._requests;n<t.length;n++)t[n].abort();for(i in this._requests.length=0,this._completePromises.length=0,this._extensions)this._extensions[i].dispose&&this._extensions[i].dispose();this._extensions={};delete this._gltf;delete this._babylonScene;delete this._rootBabylonMesh;delete this._progressCallback;this._parent._clear()}},n.prototype.importMeshAsync=function(n,t,i,r,u,f){var e=this;return Promise.resolve().then(function(){var h,c,o,l,s;if(e._babylonScene=t,e._rootUrl=r,e._fileName=f||"scene",e._progressCallback=u,e._loadData(i),h=null,n){if(c={},e._gltf.nodes)for(o=0,l=e._gltf.nodes;o<l.length;o++)s=l[o],s.name&&(c[s.name]=s.index);h=(n instanceof Array?n:[n]).map(function(n){var t=c[n];if(void 0===t)throw new Error("Failed to find node '"+n+"'");return t})}return e._loadAsync(h,function(){return{meshes:e._getMeshes(),particleSystems:[],skeletons:e._getSkeletons(),animationGroups:e._getAnimationGroups()}})})},n.prototype.loadAsync=function(n,t,i,r,u){var f=this;return Promise.resolve().then(function(){return f._babylonScene=n,f._rootUrl=i,f._fileName=u||"scene",f._progressCallback=r,f._loadData(t),f._loadAsync(null,function(){})})},n.prototype._loadAsync=function(n,t){var i=this;return Promise.resolve().then(function(){var o,s,e,l,h,c;return i._uniqueRootUrl=-1===i._rootUrl.indexOf("file:")&&i._fileName?i._rootUrl:""+i._rootUrl+Date.now()+"/",i._loadExtensions(),i._checkExtensions(),o=f.GLTFLoaderState[f.GLTFLoaderState.LOADING]+" => "+f.GLTFLoaderState[f.GLTFLoaderState.READY],s=f.GLTFLoaderState[f.GLTFLoaderState.LOADING]+" => "+f.GLTFLoaderState[f.GLTFLoaderState.COMPLETE],i._parent._startPerformanceCounter(o),i._parent._startPerformanceCounter(s),i._setState(f.GLTFLoaderState.LOADING),i._extensionsOnLoading(),e=[],l=i._babylonScene.blockMaterialDirtyMechanism,(i._babylonScene.blockMaterialDirtyMechanism=!0,n)?e.push(i.loadSceneAsync("/nodes",{nodes:n,index:-1})):(null!=i._gltf.scene||i._gltf.scenes&&i._gltf.scenes[0])&&(h=u.Get("/scene",i._gltf.scenes,i._gltf.scene||0),e.push(i.loadSceneAsync("/scenes/"+h.index,h))),i._babylonScene.blockMaterialDirtyMechanism=l,i._parent.compileMaterials&&e.push(i._compileMaterialsAsync()),i._parent.compileShadowGenerators&&e.push(i._compileShadowGeneratorsAsync()),c=Promise.all(e).then(function(){return i._rootBabylonMesh&&i._rootBabylonMesh.setEnabled(!0),i._setState(f.GLTFLoaderState.READY),i._extensionsOnReady(),i._startAnimations(),t()}),c.then(function(){i._parent._endPerformanceCounter(o);r.Tools.SetImmediate(function(){i._disposed||Promise.all(i._completePromises).then(function(){i._parent._endPerformanceCounter(s);i._setState(f.GLTFLoaderState.COMPLETE);i._parent.onCompleteObservable.notifyObservers(void 0);i._parent.onCompleteObservable.clear();i.dispose()},function(n){i._parent.onErrorObservable.notifyObservers(n);i._parent.onErrorObservable.clear();i.dispose()})})}),c},function(n){throw i._disposed||(i._parent.onErrorObservable.notifyObservers(n),i._parent.onErrorObservable.clear(),i.dispose()),n;})},n.prototype._loadData=function(n){var t,i;(this._gltf=n.json,this._setupData(),n.bin)&&(t=this._gltf.buffers,t&&t[0]&&!t[0].uri?(i=t[0],(i.byteLength<n.bin.byteLength-3||i.byteLength>n.bin.byteLength)&&r.Tools.Warn("Binary buffer length ("+i.byteLength+") from JSON does not match chunk length ("+n.bin.byteLength+")"),i._data=Promise.resolve(n.bin)):r.Tools.Warn("Unexpected BIN chunk"))},n.prototype._setupData=function(){var t,r,n,e;if(u.Assign(this._gltf.accessors),u.Assign(this._gltf.animations),u.Assign(this._gltf.buffers),u.Assign(this._gltf.bufferViews),u.Assign(this._gltf.cameras),u.Assign(this._gltf.images),u.Assign(this._gltf.materials),u.Assign(this._gltf.meshes),u.Assign(this._gltf.nodes),u.Assign(this._gltf.samplers),u.Assign(this._gltf.scenes),u.Assign(this._gltf.skins),u.Assign(this._gltf.textures),this._gltf.nodes){for(var o={},i=0,s=this._gltf.nodes;i<s.length;i++)if((n=s[i]).children)for(t=0,r=n.children;t<r.length;t++)o[r[t]]=n.index;for(var c=this._createRootNode(),f=0,h=this._gltf.nodes;f<h.length;f++)e=o[(n=h[f]).index],n.parent=void 0===e?c:this._gltf.nodes[e]}},n.prototype._loadExtensions=function(){for(var r,u,t=0,i=n._ExtensionNames;t<i.length;t++)r=i[t],u=n._ExtensionFactories[r](this),this._extensions[r]=u,this._parent.onExtensionLoadedObservable.notifyObservers(u);this._parent.onExtensionLoadedObservable.clear()},n.prototype._checkExtensions=function(){var n,t,i,r;if(this._gltf.extensionsRequired)for(n=0,t=this._gltf.extensionsRequired;n<t.length;n++)if(i=t[n],r=this._extensions[i],!r||!r.enabled)throw new Error("Require extension "+i+" is not available");},n.prototype._setState=function(n){this._state=n;this.log(f.GLTFLoaderState[this._state])},n.prototype._createRootNode=function(){this._rootBabylonMesh=new r.Mesh("__root__",this._babylonScene);this._rootBabylonMesh.setEnabled(!1);var t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case f.GLTFLoaderCoordinateSystemMode.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],n._LoadTransform(t,this._rootBabylonMesh));break;case f.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")");}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),t},n.prototype.loadSceneAsync=function(n,t){var v=this,a=this._extensionsLoadSceneAsync(n,t),r,f,s,h,i,e,c,o,l;if(a)return a;if(r=[],this.logOpen(n+" "+(t.name||"")),t.nodes)for(f=0,s=t.nodes;f<s.length;f++)h=s[f],i=u.Get(n+"/nodes/"+h,this._gltf.nodes,h),r.push(this.loadNodeAsync("/nodes/"+i.index,i,function(n){n.parent=v._rootBabylonMesh}));if(this._gltf.nodes)for(e=0,c=this._gltf.nodes;e<c.length;e++)if((i=c[e])._babylonTransformNode&&i._babylonBones)for(o=0,l=i._babylonBones;o<l.length;o++)l[o].linkTransformNode(i._babylonTransformNode);return r.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(r).then(function(){})},n.prototype._forEachPrimitive=function(n,t){if(n._primitiveBabylonMeshes)for(var i=0,r=n._primitiveBabylonMeshes;i<r.length;i++)t(r[i])},n.prototype._getMeshes=function(){var t=[],i,n,r,u;if(t.push(this._rootBabylonMesh),i=this._gltf.nodes,i)for(n=0,r=i;n<r.length;n++)u=r[n],this._forEachPrimitive(u,function(n){t.push(n)});return t},n.prototype._getSkeletons=function(){var r=[],u=this._gltf.skins,n,t,i;if(u)for(n=0,t=u;n<t.length;n++)i=t[n],i._data&&r.push(i._data.babylonSkeleton);return r},n.prototype._getAnimationGroups=function(){var r=[],u=this._gltf.animations,n,t,i;if(u)for(n=0,t=u;n<t.length;n++)i=t[n],i._babylonAnimationGroup&&r.push(i._babylonAnimationGroup);return r},n.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case f.GLTFLoaderAnimationStartMode.NONE:break;case f.GLTFLoaderAnimationStartMode.FIRST:0!==(n=this._getAnimationGroups()).length&&n[0].start(!0);break;case f.GLTFLoaderAnimationStartMode.ALL:for(var n,t=0,i=n=this._getAnimationGroups();t<i.length;t++)i[t].start(!0);break;default:return void r.Tools.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},n.prototype.loadNodeAsync=function(t,i,f){var e=this,s,o,h,l,c;if(void 0===f&&(f=function(){}),s=this._extensionsLoadNodeAsync(t,i,f),s)return s;if(i._babylonTransformNode)throw new Error(t+": Invalid recursive node hierarchy");return o=[],this.logOpen(t+" "+(i.name||"")),h=function(r){var h,s,c,l,a;if((n.AddPointerMetadata(r,t),n._LoadTransform(i,r),null!=i.camera)&&(h=u.Get(t+"/camera",e._gltf.cameras,i.camera),o.push(e.loadCameraAsync("/cameras/"+h.index,h,function(n){n.parent=r}))),i.children)for(s=0,c=i.children;s<c.length;s++)l=c[s],a=u.Get(t+"/children/"+l,e._gltf.nodes,l),o.push(e.loadNodeAsync("/nodes/"+a.index,a,function(n){n.parent=r}));f(r)},null==i.mesh?(l=i.name||"node"+i.index,i._babylonTransformNode=new r.TransformNode(l,this._babylonScene),h(i._babylonTransformNode)):(c=u.Get(t+"/mesh",this._gltf.meshes,i.mesh),o.push(this._loadMeshAsync("/meshes/"+c.index,i,c,h))),this.logClose(),Promise.all(o).then(function(){return e._forEachPrimitive(i,function(n){n.refreshBoundingInfo(!0)}),i._babylonTransformNode})},n.prototype._loadMeshAsync=function(n,t,i,f){var o=i.primitives,s,h,e,c,l,a;if(!o||!o.length)throw new Error(n+": Primitives are missing");if(null==o[0].index&&u.Assign(o),s=[],this.logOpen(n+" "+(i.name||"")),h=t.name||"node"+t.index,1===o.length)e=i.primitives[0],s.push(this._loadMeshPrimitiveAsync(n+"/primitives/"+e.index,h,t,i,e,function(n){t._babylonTransformNode=n;t._primitiveBabylonMeshes=[n]}));else for(t._babylonTransformNode=new r.TransformNode(h,this._babylonScene),t._primitiveBabylonMeshes=[],c=0,l=o;c<l.length;c++)e=l[c],s.push(this._loadMeshPrimitiveAsync(n+"/primitives/"+e.index,h+"_primitive"+e.index,t,i,e,function(n){n.parent=t._babylonTransformNode;t._primitiveBabylonMeshes.push(n)}));return null!=t.skin&&(a=u.Get(n+"/skin",this._gltf.skins,t.skin),s.push(this._loadSkinAsync("/skins/"+a.index,t,a))),f(t._babylonTransformNode),this.logClose(),Promise.all(s).then(function(){return t._babylonTransformNode})},n.prototype._loadMeshPrimitiveAsync=function(t,i,f,e,o,s){var d=this,k=this._extensionsLoadMeshPrimitiveAsync(t,i,f,e,o,s),c,v,w,y,p,h,a,l,b;return k?k:(this.logOpen(""+t),w=null==f.skin&&!e.primitives[0].targets,y=o._instanceData,w&&y?(c=y.babylonSourceMesh.createInstance(i),v=y.promise):(p=[],h=new r.Mesh(i,this._babylonScene),this._createMorphTargets(t,f,e,o,h),p.push(this._loadVertexDataAsync(t,o,h).then(function(n){return d._loadMorphTargetsAsync(t,o,h,n).then(function(){n.applyToMesh(h)})})),a=n._GetDrawMode(t,o.mode),null==o.material?(l=this._defaultBabylonMaterialData[a],l||(l=this._createDefaultMaterial("__GLTFLoader._default",a),this._parent.onMaterialLoadedObservable.notifyObservers(l),this._defaultBabylonMaterialData[a]=l),h.material=l):(b=u.Get(t+"/material",this._gltf.materials,o.material),p.push(this._loadMaterialAsync("/materials/"+b.index,b,h,a,function(n){h.material=n}))),v=Promise.all(p),w&&(o._instanceData={babylonSourceMesh:h,promise:v}),c=h),n.AddPointerMetadata(c,t),this._parent.onMeshLoadedObservable.notifyObservers(c),s(c),this.logClose(),v.then(function(){return c}))},n.prototype._loadVertexDataAsync=function(n,t,i){var c=this,l=this._extensionsLoadVertexDataAsync(n,t,i),e,o,s,h,f;if(l)return l;if(e=t.attributes,!e)throw new Error(n+": Attributes are missing");return o=[],s=new r.Geometry(i.name,this._babylonScene),null==t.indices?i.isUnIndexed=!0:(h=u.Get(n+"/indices",this._gltf.accessors,t.indices),o.push(this._loadIndicesAccessorAsync("/accessors/"+h.index,h).then(function(n){s.setIndices(n)}))),f=function(t,r,f){if(null!=e[t]){i._delayInfo=i._delayInfo||[];-1===i._delayInfo.indexOf(r)&&i._delayInfo.push(r);var h=u.Get(n+"/attributes/"+t,c._gltf.accessors,e[t]);o.push(c._loadVertexAccessorAsync("/accessors/"+h.index,h,r).then(function(n){s.setVerticesBuffer(n,h.count)}));f&&f(h)}},f("POSITION",r.VertexBuffer.PositionKind),f("NORMAL",r.VertexBuffer.NormalKind),f("TANGENT",r.VertexBuffer.TangentKind),f("TEXCOORD_0",r.VertexBuffer.UVKind),f("TEXCOORD_1",r.VertexBuffer.UV2Kind),f("JOINTS_0",r.VertexBuffer.MatricesIndicesKind),f("WEIGHTS_0",r.VertexBuffer.MatricesWeightsKind),f("COLOR_0",r.VertexBuffer.ColorKind,function(n){"VEC4"===n.type&&(i.hasVertexAlpha=!0)}),Promise.all(o).then(function(){return s})},n.prototype._createMorphTargets=function(n,t,i,u,f){var e,o;if(u.targets){if(null==t._numMorphTargets)t._numMorphTargets=u.targets.length;else if(u.targets.length!==t._numMorphTargets)throw new Error(n+": Primitives do not have the same number of targets");for(f.morphTargetManager=new r.MorphTargetManager,e=0;e<u.targets.length;e++)o=t.weights?t.weights[e]:i.weights?i.weights[e]:0,f.morphTargetManager.addTarget(new r.MorphTarget("morphTarget"+e,o))}},n.prototype._loadMorphTargetsAsync=function(n,t,i,r){var o;if(!t.targets)return Promise.resolve();for(var f=[],e=i.morphTargetManager,u=0;u<e.numTargets;u++)o=e.getTarget(u),f.push(this._loadMorphTargetVertexDataAsync(n+"/targets/"+u,r,t.targets[u],o));return Promise.all(f).then(function(){})},n.prototype._loadMorphTargetVertexDataAsync=function(n,t,i,f){var o=this,s=[],e=function(r,f,e){var h,c;null!=i[r]&&(h=t.getVertexBuffer(f),h&&(c=u.Get(n+"/"+r,o._gltf.accessors,i[r]),s.push(o._loadFloatAccessorAsync("/accessors/"+c.index,c).then(function(n){e(h,n)}))))};return e("POSITION",r.VertexBuffer.PositionKind,function(n,t){n.forEach(t.length,function(n,i){t[i]+=n});f.setPositions(t)}),e("NORMAL",r.VertexBuffer.NormalKind,function(n,t){n.forEach(t.length,function(n,i){t[i]+=n});f.setNormals(t)}),e("TANGENT",r.VertexBuffer.TangentKind,function(n,t){var i=0;n.forEach(t.length/3*4,function(n,r){(r+1)%4!=0&&(t[i++]+=n)});f.setTangents(t)}),Promise.all(s).then(function(){})},n._LoadTransform=function(n,t){if(null==n.skin){var i=r.Vector3.Zero(),u=r.Quaternion.Identity(),f=r.Vector3.One();n.matrix?r.Matrix.FromArray(n.matrix).decompose(f,u,i):(n.translation&&(i=r.Vector3.FromArray(n.translation)),n.rotation&&(u=r.Quaternion.FromArray(n.rotation)),n.scale&&(f=r.Vector3.FromArray(n.scale)));t.position=i;t.rotationQuaternion=u;t.scaling=f}},n.prototype._loadSkinAsync=function(n,t,i){var s=this,h=this._extensionsLoadSkinAsync(n,t,i),f,e,u,o;return h?h:(f=function(n){s._forEachPrimitive(t,function(t){t.skeleton=n})},i._data)?(f(i._data.babylonSkeleton),i._data.promise):(e="skeleton"+i.index,u=new r.Skeleton(i.name||e,e,this._babylonScene),u.overrideMesh=this._rootBabylonMesh,this._loadBones(n,i,u),f(u),o=this._loadSkinInverseBindMatricesDataAsync(n,i).then(function(n){s._updateBoneMatrices(u,n)}),i._data={babylonSkeleton:u,promise:o},o)},n.prototype._loadBones=function(n,t,i){for(var f,o,s={},r=0,e=t.joints;r<e.length;r++)f=e[r],o=u.Get(n+"/joints/"+f,this._gltf.nodes,f),this._loadBone(o,t,i,s)},n.prototype._loadBone=function(n,t,i,u){var f=u[n.index],e,o;return f?f:(e=null,n.parent&&n.parent._babylonTransformNode!==this._rootBabylonMesh&&(e=this._loadBone(n.parent,t,i,u)),o=t.joints.indexOf(n.index),f=new r.Bone(n.name||"joint"+n.index,i,e,this._getNodeMatrix(n),null,null,o),u[n.index]=f,n._babylonBones=n._babylonBones||[],n._babylonBones.push(f),f)},n.prototype._loadSkinInverseBindMatricesDataAsync=function(n,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);var i=u.Get(n+"/inverseBindMatrices",this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+i.index,i)},n.prototype._updateBoneMatrices=function(n,t){for(var o,u=0,e=n.bones;u<e.length;u++){var f=e[u],i=r.Matrix.Identity(),s=f._index;t&&-1!==s&&(r.Matrix.FromArrayToRef(t,16*s,i),i.invertToRef(i));o=f.getParent();o&&i.multiplyToRef(o.getInvertedAbsoluteTransform(),i);f.updateMatrix(i,!1,!1);f._updateDifferenceMatrix(void 0,!1)}},n.prototype._getNodeMatrix=function(n){return n.matrix?r.Matrix.FromArray(n.matrix):r.Matrix.Compose(n.scale?r.Vector3.FromArray(n.scale):r.Vector3.One(),n.rotation?r.Quaternion.FromArray(n.rotation):r.Quaternion.Identity(),n.translation?r.Vector3.FromArray(n.translation):r.Vector3.Zero())},n.prototype.loadCameraAsync=function(t,i,u){var o,s,f,e;if(void 0===u&&(u=function(){}),o=this._extensionsLoadCameraAsync(t,i,u),o)return o;s=[];this.logOpen(t+" "+(i.name||""));f=new r.FreeCamera(i.name||"camera"+i.index,r.Vector3.Zero(),this._babylonScene,!1);switch(f.rotation=new r.Vector3(0,Math.PI,0),i.type){case"perspective":if(e=i.perspective,!e)throw new Error(t+": Camera perspective properties are missing");f.fov=e.yfov;f.minZ=e.znear;f.maxZ=e.zfar||Number.MAX_VALUE;break;case"orthographic":if(!i.orthographic)throw new Error(t+": Camera orthographic properties are missing");f.mode=r.Camera.ORTHOGRAPHIC_CAMERA;f.orthoLeft=-i.orthographic.xmag;f.orthoRight=i.orthographic.xmag;f.orthoBottom=-i.orthographic.ymag;f.orthoTop=i.orthographic.ymag;f.minZ=i.orthographic.znear;f.maxZ=i.orthographic.zfar;break;default:throw new Error(t+": Invalid camera type ("+i.type+")");}return n.AddPointerMetadata(f,t),this._parent.onCameraLoadedObservable.notifyObservers(f),u(f),Promise.all(s).then(function(){return f})},n.prototype._loadAnimationsAsync=function(){var t=this._gltf.animations,i,n,r;if(!t)return Promise.resolve();for(i=[],n=0;n<t.length;n++)r=t[n],i.push(this.loadAnimationAsync("/animations/"+r.index,r));return Promise.all(i).then(function(){})},n.prototype.loadAnimationAsync=function(n,t){var h=this._extensionsLoadAnimationAsync(n,t),i,e,f,o,s;if(h)return h;for(i=new r.AnimationGroup(t.name||"animation"+t.index,this._babylonScene),t._babylonAnimationGroup=i,e=[],u.Assign(t.channels),u.Assign(t.samplers),f=0,o=t.channels;f<o.length;f++)s=o[f],e.push(this._loadAnimationChannelAsync(n+"/channels/"+s.index,n,t,s,i));return Promise.all(e).then(function(){return i.normalize(0),i})},n.prototype._loadAnimationChannelAsync=function(n,t,i,f,e,o){var c=this,s,h;return(void 0===o&&(o=null),null==f.target.node)?Promise.resolve():(s=u.Get(n+"/target/node",this._gltf.nodes,f.target.node),"weights"===f.target.path&&!s._numMorphTargets||"weights"!==f.target.path&&!s._babylonTransformNode)?Promise.resolve():(h=u.Get(n+"/sampler",i.samplers,f.sampler),this._loadAnimationSamplerAsync(t+"/samplers/"+f.sampler,h).then(function(t){var u,l,i,y,h,p,v,b,w,k,a;switch(f.target.path){case"translation":u="position";l=r.Animation.ANIMATIONTYPE_VECTOR3;break;case"rotation":u="rotationQuaternion";l=r.Animation.ANIMATIONTYPE_QUATERNION;break;case"scale":u="scaling";l=r.Animation.ANIMATIONTYPE_VECTOR3;break;case"weights":u="influence";l=r.Animation.ANIMATIONTYPE_FLOAT;break;default:throw new Error(n+"/target/path: Invalid value ("+f.target.path+")");}h=0;switch(u){case"position":i=function(){var n=r.Vector3.FromArray(t.output,h);return h+=3,n};break;case"rotationQuaternion":i=function(){var n=r.Quaternion.FromArray(t.output,h);return h+=4,n};break;case"scaling":i=function(){var n=r.Vector3.FromArray(t.output,h);return h+=3,n};break;case"influence":i=function(){for(var i=new Array(s._numMorphTargets),n=0;n<s._numMorphTargets;n++)i[n]=t.output[h++];return i}}switch(t.interpolation){case"STEP":y=function(n){return{frame:t.input[n],value:i(),interpolation:r.AnimationKeyInterpolation.STEP}};break;case"LINEAR":y=function(n){return{frame:t.input[n],value:i()}};break;case"CUBICSPLINE":y=function(n){return{frame:t.input[n],inTangent:i(),value:i(),outTangent:i()}}}for(p=new Array(t.input.length),v=0;v<t.input.length;v++)p[v]=y(v);if("influence"===u)for(b=function(n){var i=e.name+"_channel"+e.targetedAnimations.length,t=new r.Animation(i,u,1,l);t.setKeys(p.map(function(t){return{frame:t.frame,inTangent:t.inTangent?t.inTangent[n]:void 0,value:t.value[n],outTangent:t.outTangent?t.outTangent[n]:void 0}}));c._forEachPrimitive(s,function(i){var r=i.morphTargetManager.getTarget(n),u=t.clone();r.animations.push(u);e.addTargetedAnimation(u,r)})},w=0;w<s._numMorphTargets;w++)b(w);else k=e.name+"_channel"+e.targetedAnimations.length,a=new r.Animation(k,u,1,l),a.setKeys(p),null!=o&&null!=o.animations?(o.animations.push(a),e.addTargetedAnimation(a,o)):(s._babylonTransformNode.animations.push(a),e.addTargetedAnimation(a,s._babylonTransformNode))}))},n.prototype._loadAnimationSamplerAsync=function(n,t){var i,r,f;if(t._data)return t._data;i=t.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(n+"/interpolation: Invalid value ("+t.interpolation+")");}return r=u.Get(n+"/input",this._gltf.accessors,t.input),f=u.Get(n+"/output",this._gltf.accessors,t.output),t._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+r.index,r),this._loadFloatAccessorAsync("/accessors/"+f.index,f)]).then(function(n){var t=n[0],r=n[1];return{input:t,interpolation:i,output:r}}),t._data},n.prototype._loadBufferAsync=function(n,t){if(t._data)return t._data;if(!t.uri)throw new Error(n+"/uri: Value is missing");return t._data=this.loadUriAsync(n+"/uri",t,t.uri),t._data},n.prototype.loadBufferViewAsync=function(n,t){if(t._data)return t._data;var i=u.Get(n+"/buffer",this._gltf.buffers,t.buffer);return t._data=this._loadBufferAsync("/buffers/"+i.index,i).then(function(i){try{return new Uint8Array(i.buffer,i.byteOffset+(t.byteOffset||0),t.byteLength)}catch(t){throw new Error(n+": "+t.message);}}),t._data},n.prototype._loadIndicesAccessorAsync=function(t,i){if("SCALAR"!==i.type)throw new Error(t+"/type: Invalid value "+i.type);if(5121!==i.componentType&&5123!==i.componentType&&5125!==i.componentType)throw new Error(t+"/componentType: Invalid value "+i.componentType);if(i._data)return i._data;var r=u.Get(t+"/bufferView",this._gltf.bufferViews,i.bufferView);return i._data=this.loadBufferViewAsync("/bufferViews/"+r.index,r).then(function(r){return n._GetTypedArray(t,i.componentType,r,i.byteOffset,i.count)}),i._data},n.prototype._loadFloatAccessorAsync=function(t,i){var e=this,f,o,s,r;if(5126!==i.componentType)throw new Error("Invalid component type "+i.componentType);return i._data?i._data:(f=n._GetNumComponents(t,i.type),o=f*i.count,null==i.bufferView?i._data=Promise.resolve(new Float32Array(o)):(s=u.Get(t+"/bufferView",this._gltf.bufferViews,i.bufferView),i._data=this.loadBufferViewAsync("/bufferViews/"+s.index,s).then(function(r){return n._GetTypedArray(t,i.componentType,r,i.byteOffset,o)})),i.sparse&&(r=i.sparse,i._data=i._data.then(function(o){var s=o,h=u.Get(t+"/sparse/indices/bufferView",e._gltf.bufferViews,r.indices.bufferView),c=u.Get(t+"/sparse/values/bufferView",e._gltf.bufferViews,r.values.bufferView);return Promise.all([e.loadBufferViewAsync("/bufferViews/"+h.index,h),e.loadBufferViewAsync("/bufferViews/"+c.index,c)]).then(function(u){for(var c,o,l=u[0],a=u[1],h=n._GetTypedArray(t+"/sparse/indices",r.indices.componentType,l,r.indices.byteOffset,r.count),v=n._GetTypedArray(t+"/sparse/values",i.componentType,a,r.values.byteOffset,f*r.count),y=0,e=0;e<h.length;e++)for(c=h[e]*f,o=0;o<f;o++)s[c++]=v[y++];return s})})),i._data)},n.prototype._loadVertexBufferViewAsync=function(n){var t=this;return n._babylonBuffer?n._babylonBuffer:(n._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+n.index,n).then(function(n){return new r.Buffer(t._babylonScene.getEngine(),n,!1)}),n._babylonBuffer)},n.prototype._loadVertexAccessorAsync=function(t,i,f){var e=this,o;return i._babylonVertexBuffer?i._babylonVertexBuffer:(i.sparse?i._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+i.index,i).then(function(n){return new r.VertexBuffer(e._babylonScene.getEngine(),n,f,!1)}):i.byteOffset&&i.byteOffset%r.VertexBuffer.GetTypeByteLength(i.componentType)!=0?(r.Tools.Warn("Accessor byte offset is not a multiple of component type byte length"),i._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+i.index,i).then(function(n){return new r.VertexBuffer(e._babylonScene.getEngine(),n,f,!1)})):(o=u.Get(t+"/bufferView",this._gltf.bufferViews,i.bufferView),i._babylonVertexBuffer=this._loadVertexBufferViewAsync(o,f).then(function(u){var s=n._GetNumComponents(t,i.type);return new r.VertexBuffer(e._babylonScene.getEngine(),u,f,!1,!1,o.byteStride,!1,i.byteOffset,s,i.componentType,i.normalized,!0)})),i._babylonVertexBuffer)},n.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(n,t,i){if(!(i instanceof r.PBRMaterial))throw new Error(n+": Material type not supported");var u=[];return t&&(t.baseColorFactor?(i.albedoColor=r.Color3.FromArray(t.baseColorFactor),i.alpha=t.baseColorFactor[3]):i.albedoColor=r.Color3.White(),i.metallic=null==t.metallicFactor?1:t.metallicFactor,i.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&u.push(this.loadTextureInfoAsync(n+"/baseColorTexture",t.baseColorTexture,function(n){n.name=i.name+" (Base Color)";i.albedoTexture=n})),t.metallicRoughnessTexture&&(u.push(this.loadTextureInfoAsync(n+"/metallicRoughnessTexture",t.metallicRoughnessTexture,function(n){n.name=i.name+" (Metallic Roughness)";i.metallicTexture=n})),i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(u).then(function(){})},n.prototype._loadMaterialAsync=function(t,i,r,u,f){var s,e,o;return(void 0===f&&(f=function(){}),s=this._extensionsLoadMaterialAsync(t,i,r,u,f),s)?s:(i._data=i._data||{},e=i._data[u],e||(this.logOpen(t+" "+(i.name||"")),o=this.createMaterial(t,i,u),e={babylonMaterial:o,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,i,o)},i._data[u]=e,n.AddPointerMetadata(o,t),this._parent.onMaterialLoadedObservable.notifyObservers(o),this.logClose()),e.babylonMeshes.push(r),r.onDisposeObservable.addOnce(function(){var n=e.babylonMeshes.indexOf(r);-1!==n&&e.babylonMeshes.splice(n,1)}),f(e.babylonMaterial),e.promise.then(function(){return e.babylonMaterial}))},n.prototype._createDefaultMaterial=function(n,t){var i=new r.PBRMaterial(n,this._babylonScene);return i.sideOrientation=this._babylonScene.useRightHandedSystem?r.Material.CounterClockWiseSideOrientation:r.Material.ClockWiseSideOrientation,i.fillMode=t,i.enableSpecularAntiAliasing=!0,i.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,i.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,i.transparencyMode=r.PBRMaterial.PBRMATERIAL_OPAQUE,i.metallic=1,i.roughness=1,i},n.prototype.createMaterial=function(n,t,i){var r=this._extensionsCreateMaterial(n,t,i),u;return r?r:(u=t.name||"material"+t.index,this._createDefaultMaterial(u,i))},n.prototype.loadMaterialPropertiesAsync=function(n,t,i){var u=this._extensionsLoadMaterialPropertiesAsync(n,t,i),r;return u?u:(r=[],r.push(this.loadMaterialBasePropertiesAsync(n,t,i)),t.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(n+"/pbrMetallicRoughness",t.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(n,t,i),Promise.all(r).then(function(){}))},n.prototype.loadMaterialBasePropertiesAsync=function(n,t,i){if(!(i instanceof r.PBRMaterial))throw new Error(n+": Material type not supported");var u=[];return i.emissiveColor=t.emissiveFactor?r.Color3.FromArray(t.emissiveFactor):new r.Color3(0,0,0),t.doubleSided&&(i.backFaceCulling=!1,i.twoSidedLighting=!0),t.normalTexture&&(u.push(this.loadTextureInfoAsync(n+"/normalTexture",t.normalTexture,function(n){n.name=i.name+" (Normal)";i.bumpTexture=n})),i.invertNormalMapX=!this._babylonScene.useRightHandedSystem,i.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&(i.bumpTexture.level=t.normalTexture.scale),i.forceIrradianceInFragment=!0),t.occlusionTexture&&(u.push(this.loadTextureInfoAsync(n+"/occlusionTexture",t.occlusionTexture,function(n){n.name=i.name+" (Occlusion)";i.ambientTexture=n})),i.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(i.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&u.push(this.loadTextureInfoAsync(n+"/emissiveTexture",t.emissiveTexture,function(n){n.name=i.name+" (Emissive)";i.emissiveTexture=n})),Promise.all(u).then(function(){})},n.prototype.loadMaterialAlphaProperties=function(n,t,i){if(!(i instanceof r.PBRMaterial))throw new Error(n+": Material type not supported");switch(t.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=r.PBRMaterial.PBRMATERIAL_OPAQUE;break;case"MASK":i.transparencyMode=r.PBRMaterial.PBRMATERIAL_ALPHATEST;i.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff;i.albedoTexture&&(i.albedoTexture.hasAlpha=!0);break;case"BLEND":i.transparencyMode=r.PBRMaterial.PBRMATERIAL_ALPHABLEND;i.albedoTexture&&(i.albedoTexture.hasAlpha=!0,i.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(n+"/alphaMode: Invalid value ("+t.alphaMode+")");}},n.prototype.loadTextureInfoAsync=function(t,i,r){var s=this,f,e,o;return(void 0===r&&(r=function(){}),f=this._extensionsLoadTextureInfoAsync(t,i,r),f)?f:(this.logOpen(""+t),e=u.Get(t+"/index",this._gltf.textures,i.index),o=this._loadTextureAsync("/textures/"+i.index,e,function(u){u.coordinatesIndex=i.texCoord||0;n.AddPointerMetadata(u,t);s._parent.onTextureLoadedObservable.notifyObservers(u);r(u)}),this.logClose(),o)},n.prototype._loadTextureAsync=function(t,i,f){var s=this,h,a,o;void 0===f&&(f=function(){});h=[];this.logOpen(t+" "+(i.name||""));var v=null==i.sampler?n._DefaultSampler:u.Get(t+"/sampler",this._gltf.samplers,i.sampler),c=this._loadSampler("/samplers/"+v.index,v),e=u.Get(t+"/source",this._gltf.images,i.source),l=null;return e.uri&&(r.Tools.IsBase64(e.uri)?l=e.uri:this._babylonScene.getEngine().textureFormatInUse&&(l=this._rootUrl+e.uri)),a=new r.Deferred,o=new r.Texture(l,this._babylonScene,c.noMipMaps,!1,c.samplingMode,function(){s._disposed||a.resolve()},function(n,i){s._disposed||a.reject(new Error(t+": "+(i&&i.message?i.message:n||"Failed to load texture")))}),h.push(a.promise),l||h.push(this.loadImageAsync("/images/"+e.index,e).then(function(n){var t=e.uri||s._fileName+"#image"+e.index,i="data:"+s._uniqueRootUrl+t;o.updateURL(i,new Blob([n],{type:e.mimeType}))})),o.wrapU=c.wrapU,o.wrapV=c.wrapV,f(o),this.logClose(),Promise.all(h).then(function(){return o})},n.prototype._loadSampler=function(t,i){return i._data||(i._data={noMipMaps:9728===i.minFilter||9729===i.minFilter,samplingMode:n._GetTextureSamplingMode(t,i),wrapU:n._GetTextureWrapMode(t+"/wrapS",i.wrapS),wrapV:n._GetTextureWrapMode(t+"/wrapT",i.wrapT)}),i._data},n.prototype.loadImageAsync=function(n,t){if(!t._data){if(this.logOpen(n+" "+(t.name||"")),t.uri)t._data=this.loadUriAsync(n+"/uri",t,t.uri);else{var i=u.Get(n+"/bufferView",this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/"+i.index,i)}this.logClose()}return t._data},n.prototype.loadUriAsync=function(t,i,u){var e=this,s=this._extensionsLoadUriAsync(t,i,u),o;if(s)return s;if(!n._ValidateUri(u))throw new Error(t+": '"+u+"' is invalid");return r.Tools.IsBase64(u)?(o=new Uint8Array(r.Tools.DecodeBase64(u)),this.log("Decoded "+u.substr(0,64)+"... ("+o.length+" bytes)"),Promise.resolve(o)):(this.log("Loading "+u),this._parent.preprocessUrlAsync(this._rootUrl+u).then(function(n){return new Promise(function(i,o){if(!e._disposed){var s=r.Tools.LoadFile(n,function(n){if(!e._disposed){var t=new Uint8Array(n);e.log("Loaded "+u+" ("+t.length+" bytes)");i(t)}},function(n){if(!e._disposed&&(s&&(s._lengthComputable=n.lengthComputable,s._loaded=n.loaded,s._total=n.total),e._state===f.GLTFLoaderState.LOADING))try{e._onProgress()}catch(n){o(n)}},e._babylonScene.offlineProvider,!0,function(n){e._disposed||o(new r.LoadFileError(t+": Failed to load '"+u+"'"+(n?": "+n.status+" "+n.statusText:""),n))});e._requests.push(s)}})}))},n.prototype._onProgress=function(){var n;if(this._progressCallback){for(var t=!0,u=0,f=0,i=0,e=this._requests;i<e.length;i++){if(n=e[i],void 0===n._lengthComputable||void 0===n._loaded||void 0===n._total)return;t=t&&n._lengthComputable;u+=n._loaded;f+=n._total}this._progressCallback(new r.SceneLoaderProgressEvent(t,u,t?f:0))}},n.AddPointerMetadata=function(n,t){var i=n.metadata=n.metadata||{},r=i.gltf=i.gltf||{};(r.pointers=r.pointers||[]).push(t)},n._GetTextureWrapMode=function(n,t){switch(t=null==t?10497:t){case 33071:return r.Texture.CLAMP_ADDRESSMODE;case 33648:return r.Texture.MIRROR_ADDRESSMODE;case 10497:return r.Texture.WRAP_ADDRESSMODE;default:return r.Tools.Warn(n+": Invalid value ("+t+")"),r.Texture.WRAP_ADDRESSMODE}},n._GetTextureSamplingMode=function(n,t){var u=null==t.magFilter?9729:t.magFilter,i=null==t.minFilter?9987:t.minFilter;if(9729===u)switch(i){case 9728:return r.Texture.LINEAR_NEAREST;case 9729:return r.Texture.LINEAR_LINEAR;case 9984:return r.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return r.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return r.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return r.Texture.LINEAR_LINEAR_MIPLINEAR;default:return r.Tools.Warn(n+"/minFilter: Invalid value ("+i+")"),r.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==u&&r.Tools.Warn(n+"/magFilter: Invalid value ("+u+")"),i){case 9728:return r.Texture.NEAREST_NEAREST;case 9729:return r.Texture.NEAREST_LINEAR;case 9984:return r.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return r.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return r.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return r.Texture.NEAREST_LINEAR_MIPLINEAR;default:return r.Tools.Warn(n+"/minFilter: Invalid value ("+i+")"),r.Texture.NEAREST_NEAREST_MIPNEAREST}},n._GetTypedArray=function(n,t,i,r,u){var f=i.buffer;r=i.byteOffset+(r||0);try{switch(t){case 5120:return new Int8Array(f,r,u);case 5121:return new Uint8Array(f,r,u);case 5122:return new Int16Array(f,r,u);case 5123:return new Uint16Array(f,r,u);case 5125:return new Uint32Array(f,r,u);case 5126:return new Float32Array(f,r,u);default:throw new Error("Invalid component type "+t);}}catch(t){throw new Error(n+": "+t);}},n._GetNumComponents=function(n,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(n+": Invalid type ("+t+")");},n._ValidateUri=function(n){return r.Tools.IsBase64(n)||-1===n.indexOf("..")},n._GetDrawMode=function(n,t){switch(null==t&&(t=4),t){case 0:return r.Material.PointListDrawMode;case 1:return r.Material.LineListDrawMode;case 2:return r.Material.LineLoopDrawMode;case 3:return r.Material.LineStripDrawMode;case 4:return r.Material.TriangleFillMode;case 5:return r.Material.TriangleStripDrawMode;case 6:return r.Material.TriangleFanDrawMode}throw new Error(n+": Invalid mesh primitive mode ("+t+")");},n.prototype._compileMaterialsAsync=function(){var c=this,n,t,u,i,o,r,e;if(this._parent._startPerformanceCounter("Compile materials"),n=[],this._gltf.materials)for(t=0,u=this._gltf.materials;t<u.length;t++)if(i=u[t],i._data)for(o in i._data)for(var s=i._data[o],f=0,h=s.babylonMeshes;f<h.length;f++)r=h[f],r.computeWorldMatrix(!0),e=s.babylonMaterial,n.push(e.forceCompilationAsync(r)),this._parent.useClipPlane&&n.push(e.forceCompilationAsync(r,{clipPlane:!0}));return Promise.all(n).then(function(){c._parent._endPerformanceCounter("Compile materials")})},n.prototype._compileShadowGeneratorsAsync=function(){var u=this,t;this._parent._startPerformanceCounter("Compile shadow generators");for(var i=[],n=0,r=this._babylonScene.lights;n<r.length;n++)t=r[n].getShadowGenerator(),t&&i.push(t.forceCompilationAsync());return Promise.all(i).then(function(){u._parent._endPerformanceCounter("Compile shadow generators")})},n.prototype._forEachExtensions=function(t){for(var f,u,i=0,r=n._ExtensionNames;i<r.length;i++)f=r[i],u=this._extensions[f],u.enabled&&t(u)},n.prototype._applyExtensions=function(t,i,r){for(var h,c,f,e,o,l,u=0,s=n._ExtensionNames;u<s.length;u++)if(h=s[u],c=this._extensions[h],c.enabled&&(f=h+"."+i,e=t,e._activeLoaderExtensionFunctions=e._activeLoaderExtensionFunctions||{},o=e._activeLoaderExtensionFunctions,!o[f])){o[f]=!0;try{if(l=r(c),l)return l}finally{delete o[f]}}return null},n.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(n){return n.onLoading&&n.onLoading()})},n.prototype._extensionsOnReady=function(){this._forEachExtensions(function(n){return n.onReady&&n.onReady()})},n.prototype._extensionsLoadSceneAsync=function(n,t){return this._applyExtensions(t,"loadScene",function(i){return i.loadSceneAsync&&i.loadSceneAsync(n,t)})},n.prototype._extensionsLoadNodeAsync=function(n,t,i){return this._applyExtensions(t,"loadNode",function(r){return r.loadNodeAsync&&r.loadNodeAsync(n,t,i)})},n.prototype._extensionsLoadCameraAsync=function(n,t,i){return this._applyExtensions(t,"loadCamera",function(r){return r.loadCameraAsync&&r.loadCameraAsync(n,t,i)})},n.prototype._extensionsLoadVertexDataAsync=function(n,t,i){return this._applyExtensions(t,"loadVertexData",function(r){return r._loadVertexDataAsync&&r._loadVertexDataAsync(n,t,i)})},n.prototype._extensionsLoadMeshPrimitiveAsync=function(n,t,i,r,u,f){return this._applyExtensions(u,"loadMeshPrimitive",function(e){return e._loadMeshPrimitiveAsync&&e._loadMeshPrimitiveAsync(n,t,i,r,u,f)})},n.prototype._extensionsLoadMaterialAsync=function(n,t,i,r,u){return this._applyExtensions(t,"loadMaterial",function(f){return f._loadMaterialAsync&&f._loadMaterialAsync(n,t,i,r,u)})},n.prototype._extensionsCreateMaterial=function(n,t,i){return this._applyExtensions(t,"createMaterial",function(r){return r.createMaterial&&r.createMaterial(n,t,i)})},n.prototype._extensionsLoadMaterialPropertiesAsync=function(n,t,i){return this._applyExtensions(t,"loadMaterialProperties",function(r){return r.loadMaterialPropertiesAsync&&r.loadMaterialPropertiesAsync(n,t,i)})},n.prototype._extensionsLoadTextureInfoAsync=function(n,t,i){return this._applyExtensions(t,"loadTextureInfo",function(r){return r.loadTextureInfoAsync&&r.loadTextureInfoAsync(n,t,i)})},n.prototype._extensionsLoadAnimationAsync=function(n,t){return this._applyExtensions(t,"loadAnimation",function(i){return i.loadAnimationAsync&&i.loadAnimationAsync(n,t)})},n.prototype._extensionsLoadSkinAsync=function(n,t,i){return this._applyExtensions(i,"loadSkin",function(r){return r._loadSkinAsync&&r._loadSkinAsync(n,t,i)})},n.prototype._extensionsLoadUriAsync=function(n,t,i){return this._applyExtensions(t,"loadUri",function(r){return r._loadUriAsync&&r._loadUriAsync(n,t,i)})},n.LoadExtensionAsync=function(n,t,i,r){if(!t.extensions)return null;var u=t.extensions[i];return u?r(n+"/extensions/"+i,u):null},n.LoadExtraAsync=function(n,t,i,r){if(!t.extras)return null;var u=t.extras[i];return u?r(n+"/extras/"+i,u):null},n.prototype.logOpen=function(n){this._parent._logOpen(n)},n.prototype.logClose=function(){this._parent._logClose()},n.prototype.log=function(n){this._parent._log(n)},n.prototype.startPerformanceCounter=function(n){this._parent._startPerformanceCounter(n)},n.prototype.endPerformanceCounter=function(n){this._parent._endPerformanceCounter(n)},n._DefaultSampler={index:-1},n._ExtensionNames=[],n._ExtensionFactories={},n}();f.GLTFFileLoader._CreateGLTF2Loader=function(n){return new e(n)}},function(n,t,i){"use strict";var u,f,e,r,o,s;i.r(t);i.d(t,"GLTFLoaderCoordinateSystemMode",function(){return u});i.d(t,"GLTFLoaderAnimationStartMode",function(){return f});i.d(t,"GLTFLoaderState",function(){return e});i.d(t,"GLTFFileLoader",function(){return o});r=i(0);!function(n){n[n.AUTO=0]="AUTO";n[n.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(u||(u={})),function(n){n[n.NONE=0]="NONE";n[n.FIRST=1]="FIRST";n[n.ALL=2]="ALL"}(f||(f={})),function(n){n[n.LOADING=0]="LOADING";n[n.READY=1]="READY";n[n.COMPLETE=2]="COMPLETE"}(e||(e={}));o=function(){function n(){this.onParsedObservable=new r.Observable;this.coordinateSystemMode=u.AUTO;this.animationStartMode=f.FIRST;this.compileMaterials=!1;this.useClipPlane=!1;this.compileShadowGenerators=!1;this.transparencyAsCoverage=!1;this.preprocessUrlAsync=function(n){return Promise.resolve(n)};this.onMeshLoadedObservable=new r.Observable;this.onTextureLoadedObservable=new r.Observable;this.onMaterialLoadedObservable=new r.Observable;this.onCameraLoadedObservable=new r.Observable;this.onCompleteObservable=new r.Observable;this.onErrorObservable=new r.Observable;this.onDisposeObservable=new r.Observable;this.onExtensionLoadedObservable=new r.Observable;this.validate=!1;this.onValidatedObservable=new r.Observable;this._loader=null;this.name="gltf";this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}};this._logIndentLevel=0;this._loggingEnabled=!1;this._log=this._logDisabled;this._capturePerformanceCounters=!1;this._startPerformanceCounter=this._startPerformanceCounterDisabled;this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(n.prototype,"onParsed",{set:function(n){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver);this._onParsedObserver=this.onParsedObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onMeshLoaded",{set:function(n){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver);this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onTextureLoaded",{set:function(n){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver);this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onMaterialLoaded",{set:function(n){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver);this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onCameraLoaded",{set:function(n){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver);this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onComplete",{set:function(n){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver);this._onCompleteObserver=this.onCompleteObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onError",{set:function(n){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver);this._onErrorObserver=this.onErrorObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onDispose",{set:function(n){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onExtensionLoaded",{set:function(n){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver);this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(n){this._loggingEnabled!==n&&(this._loggingEnabled=n,this._log=this._loggingEnabled?this._logEnabled:this._logDisabled)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(n){this._capturePerformanceCounters!==n&&(this._capturePerformanceCounters=n,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onValidated",{set:function(n){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver);this._onValidatedObserver=this.onValidatedObservable.add(n)},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);this._clear();this.onDisposeObservable.notifyObservers(void 0);this.onDisposeObservable.clear()},n.prototype._clear=function(){this.preprocessUrlAsync=function(n){return Promise.resolve(n)};this.onMeshLoadedObservable.clear();this.onTextureLoadedObservable.clear();this.onMaterialLoadedObservable.clear();this.onCameraLoadedObservable.clear();this.onCompleteObservable.clear();this.onExtensionLoadedObservable.clear()},n.prototype.importMeshAsync=function(n,t,i,r,u,f){var e=this;return this._parseAsync(t,i,r,f).then(function(i){return e._log("Loading "+(f||"")),e._loader=e._getLoader(i),e._loader.importMeshAsync(n,t,i,r,u,f)})},n.prototype.loadAsync=function(n,t,i,r,u){var f=this;return this._parseAsync(n,t,i,u).then(function(t){return f._log("Loading "+(u||"")),f._loader=f._getLoader(t),f._loader.loadAsync(n,t,i,r,u)})},n.prototype.loadAssetContainerAsync=function(n,t,i,u,f){var e=this;return this._parseAsync(n,t,i,f).then(function(t){var o,s;return e._log("Loading "+(f||"")),e._loader=e._getLoader(t),o=[],e.onMaterialLoadedObservable.add(function(n){o.push(n)}),s=[],e.onTextureLoadedObservable.add(function(n){s.push(n)}),e._loader.importMeshAsync(null,n,t,i,u,f).then(function(t){var i=new r.AssetContainer(n);return Array.prototype.push.apply(i.meshes,t.meshes),Array.prototype.push.apply(i.particleSystems,t.particleSystems),Array.prototype.push.apply(i.skeletons,t.skeletons),Array.prototype.push.apply(i.animationGroups,t.animationGroups),Array.prototype.push.apply(i.materials,o),Array.prototype.push.apply(i.textures,s),i.removeAllFromScene(),i})})},n.prototype.canDirectLoad=function(n){return-1!==n.indexOf("scene")&&-1!==n.indexOf("node")},n.prototype.createPlugin=function(){return new n},Object.defineProperty(n.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!0,configurable:!0}),n.prototype.whenCompleteAsync=function(){var n=this;return new Promise(function(t,i){n.onCompleteObservable.addOnce(function(){t()});n.onErrorObservable.addOnce(function(n){i(n)})})},n.prototype._parseAsync=function(n,t,i,r){var u=this;return Promise.resolve().then(function(){return u._validateAsync(n,t,i,r).then(function(){var n=t instanceof ArrayBuffer?u._unpackBinary(t):{json:t,bin:null},i;return u._startPerformanceCounter("Parse JSON"),u._log("JSON length: "+n.json.length),i={json:JSON.parse(n.json),bin:n.bin},u._endPerformanceCounter("Parse JSON"),u.onParsedObservable.notifyObservers(i),u.onParsedObservable.clear(),i})})},n.prototype._validateAsync=function(n,t,i,u){var f=this,e;return!this.validate||"undefined"==typeof GLTFValidator?Promise.resolve():(this._startPerformanceCounter("Validate JSON"),e={externalResourceFunction:function(t){return f.preprocessUrlAsync(i+t).then(function(t){return n._loadFileAsync(t,!0,!0)}).then(function(n){return new Uint8Array(n)})}},u&&"data:"!==u.substr(0,5)&&(e.uri="file:"===i?u:""+i+u),(t instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(t),e):GLTFValidator.validateString(t,e)).then(function(n){f._endPerformanceCounter("Validate JSON");f.onValidatedObservable.notifyObservers(n);f.onValidatedObservable.clear()},function(n){f._endPerformanceCounter("Validate JSON");r.Tools.Warn("Failed to validate: "+n);f.onValidatedObservable.clear()}))},n.prototype._getLoader=function(t){var i=t.json.asset||{},r,u,f;if(this._log("Asset version: "+i.version),i.minVersion&&this._log("Asset minimum version: "+i.minVersion),i.generator&&this._log("Asset generator: "+i.generator),r=n._parseVersion(i.version),!r)throw new Error("Invalid version: "+i.version);if(void 0!==i.minVersion){if(u=n._parseVersion(i.minVersion),!u)throw new Error("Invalid minimum version: "+i.minVersion);if(n._compareVersion(u,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+i.minVersion);}if(f={1:n._CreateGLTF1Loader,2:n._CreateGLTF2Loader}[r.major],!f)throw new Error("Unsupported version: "+i.version);return f(this)},n.prototype._unpackBinary=function(n){var t,r,u,i;if(this._startPerformanceCounter("Unpack binary"),this._log("Binary length: "+n.byteLength),t=new s(n),r=t.readUint32(),1179937895!==r)throw new Error("Unexpected magic: "+r);i=t.readUint32();switch(this.loggingEnabled&&this._log("Binary version: "+i),i){case 1:u=this._unpackBinaryV1(t);break;case 2:u=this._unpackBinaryV2(t);break;default:throw new Error("Unsupported version: "+i);}return this._endPerformanceCounter("Unpack binary"),u},n.prototype._unpackBinaryV1=function(t){var r=t.readUint32(),u,f,i,e;if(r!=t.getLength())throw new Error("Length in header does not match actual data length: "+r+" != "+t.getLength());f=t.readUint32();i=t.readUint32();switch(i){case 0:u=n._decodeBufferToText(t.readUint8Array(f));break;default:throw new Error("Unexpected content format: "+i);}return e=t.getLength()-t.getPosition(),{json:u,bin:t.readUint8Array(e)}},n.prototype._unpackBinaryV2=function(t){var u=1313821514,f=t.readUint32(),e,o,i,r;if(f!==t.getLength())throw new Error("Length in header does not match actual data length: "+f+" != "+t.getLength());if(e=t.readUint32(),t.readUint32()!==u)throw new Error("First chunk format is not JSON");for(o=n._decodeBufferToText(t.readUint8Array(e)),i=null;t.getPosition()<t.getLength();){r=t.readUint32();switch(t.readUint32()){case u:throw new Error("Unexpected JSON chunk");case 5130562:i=t.readUint8Array(r);break;default:t.skipBytes(r)}}return{json:o,bin:i}},n._parseVersion=function(n){if("1.0"===n||"1.0.1"===n)return{major:1,minor:0};var t=(n+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null},n._compareVersion=function(n,t){return n.major>t.major?1:n.major<t.major?-1:n.minor>t.minor?1:n.minor<t.minor?-1:0},n._decodeBufferToText=function(n){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(n);for(var i="",r=n.byteLength,t=0;t<r;t++)i+=String.fromCharCode(n[t]);return i},n.prototype._logOpen=function(n){this._log(n);this._logIndentLevel++},n.prototype._logClose=function(){--this._logIndentLevel},n.prototype._logEnabled=function(t){var i=n._logSpaces.substr(0,2*this._logIndentLevel);r.Tools.Log(""+i+t)},n.prototype._logDisabled=function(){},n.prototype._startPerformanceCounterEnabled=function(n){r.Tools.StartPerformanceCounter(n)},n.prototype._startPerformanceCounterDisabled=function(){},n.prototype._endPerformanceCounterEnabled=function(n){r.Tools.EndPerformanceCounter(n)},n.prototype._endPerformanceCounterDisabled=function(){},n.IncrementalLoading=!0,n.HomogeneousCoordinates=!1,n._logSpaces="                                ",n}();s=function(){function n(n){this._arrayBuffer=n;this._dataView=new DataView(n);this._byteOffset=0}return n.prototype.getPosition=function(){return this._byteOffset},n.prototype.getLength=function(){return this._arrayBuffer.byteLength},n.prototype.readUint32=function(){var n=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,n},n.prototype.readUint8Array=function(n){var t=new Uint8Array(this._arrayBuffer,this._byteOffset,n);return this._byteOffset+=n,t},n.prototype.skipBytes=function(n){this._byteOffset+=n},n}();r.SceneLoader&&r.SceneLoader.RegisterPlugin(new o)},function(n){var t=function(){return this}();try{t=t||new Function("return this")()}catch(n){"object"==typeof window&&(t=window)}n.exports=t},function(n,t,i){"use strict";var e,o,f,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it;i.r(t);var r=i(0),u=i(1),rt="EXT_lights_image_based",ut=function(){function n(n){this.name=rt;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader;delete this._lights},n.prototype.onLoading=function(){var n=this._loader.gltf.extensions,t;n&&n[this.name]&&(t=n[this.name],this._lights=t.lights)},n.prototype.loadSceneAsync=function(n,t){var i=this;return u.b.LoadExtensionAsync(n,t,this.name,function(r,f){var e=[],o;return e.push(i._loader.loadSceneAsync(n,t)),i._loader.logOpen(""+r),o=u.a.Get(r+"/light",i._lights,f.light),e.push(i._loadLightAsync("#/extensions/"+i.name+"/lights/"+f.light,o).then(function(n){i._loader.babylonScene.environmentTexture=n})),i._loader.logClose(),Promise.all(e).then(function(){})})},n.prototype._loadLightAsync=function(n,t){var s=this,e;if(!t._loaded){e=[];this._loader.logOpen(""+n);for(var i=new Array(t.specularImages.length),h=function(r){var s=t.specularImages[r],h,o;for(i[r]=new Array(s.length),h=function(t){var h=n+"/specularImages/"+r+"/"+t,o,c;f._loader.logOpen(""+h);o=s[t];c=u.a.Get(h,f._loader.gltf.images,o);e.push(f._loader.loadImageAsync("#/images/"+o,c).then(function(n){i[r][t]=n}));f._loader.logClose()},o=0;o<s.length;o++)h(o)},f=this,o=0;o<t.specularImages.length;o++)h(o);this._loader.logClose();t._loaded=Promise.all(e).then(function(){var n=new r.RawCubeTexture(s._loader.babylonScene,null,t.specularImageSize),u,f,e,o;return(t._babylonTexture=n,null!=t.intensity&&(n.level=t.intensity),t.rotation)&&(u=r.Quaternion.FromArray(t.rotation),s._loader.babylonScene.useRightHandedSystem||(u=r.Quaternion.Inverse(u)),r.Matrix.FromQuaternionToRef(u,n.getReflectionTextureMatrix())),f=r.SphericalHarmonics.FromArray(t.irradianceCoefficients),f.scaleInPlace(t.intensity),f.convertIrradianceToLambertianRadiance(),e=r.SphericalPolynomial.FromHarmonics(f),o=(i.length-1)/r.Scalar.Log2(t.specularImageSize),n.updateRGBDAsync(i,e,o)})}return t._loaded.then(function(){return t._babylonTexture})},n}();u.b.RegisterExtension(rt,function(n){return new ut(n)});e="KHR_draco_mesh_compression";o=function(){function n(n){this.name=e;this.enabled=r.DracoCompression.DecoderAvailable;this._loader=n}return n.prototype.dispose=function(){delete this.dracoCompression;delete this._loader},n.prototype._loadVertexDataAsync=function(n,t,i){var f=this;return u.b.LoadExtensionAsync(n,t,this.name,function(e,o){var c,s,h;if(null!=t.mode){if(5!==t.mode&&4!==t.mode)throw new Error(n+": Unsupported mode "+t.mode);if(5===t.mode)throw new Error(n+": Mode "+t.mode+" is not currently supported");}return c={},s=function(n,t){var r=o.attributes[n];null!=r&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(t)&&i._delayInfo.push(t),c[t]=r)},s("POSITION",r.VertexBuffer.PositionKind),s("NORMAL",r.VertexBuffer.NormalKind),s("TANGENT",r.VertexBuffer.TangentKind),s("TEXCOORD_0",r.VertexBuffer.UVKind),s("TEXCOORD_1",r.VertexBuffer.UV2Kind),s("JOINTS_0",r.VertexBuffer.MatricesIndicesKind),s("WEIGHTS_0",r.VertexBuffer.MatricesWeightsKind),s("COLOR_0",r.VertexBuffer.ColorKind),h=u.a.Get(e,f._loader.gltf.bufferViews,o.bufferView),h._dracoBabylonGeometry||(h._dracoBabylonGeometry=f._loader.loadBufferViewAsync("#/bufferViews/"+h.index,h).then(function(t){return(f.dracoCompression||r.DracoCompression.Default).decodeMeshAsync(t,c).then(function(n){var t=new r.Geometry(i.name,f._loader.babylonScene);return n.applyToGeometry(t),t}).catch(function(t){throw new Error(n+": "+t.message);})})),h._dracoBabylonGeometry})},n}();u.b.RegisterExtension(e,function(n){return new o(n)});s="KHR_lights_punctual";!function(n){n.DIRECTIONAL="directional";n.POINT="point";n.SPOT="spot"}(f||(f={}));h=function(){function n(n){this.name=s;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader;delete this._lights},n.prototype.onLoading=function(){var n=this._loader.gltf.extensions,t;n&&n[this.name]&&(t=n[this.name],this._lights=t.lights)},n.prototype.loadNodeAsync=function(n,t,i){var e=this;return u.b.LoadExtensionAsync(n,t,this.name,function(o,s){return e._loader.loadNodeAsync(n,t,function(n){var h,t=u.a.Get(o,e._lights,s.light),l=t.name||n.name,c;switch(t.type){case f.DIRECTIONAL:h=new r.DirectionalLight(l,r.Vector3.Backward(),e._loader.babylonScene);break;case f.POINT:h=new r.PointLight(l,r.Vector3.Zero(),e._loader.babylonScene);break;case f.SPOT:c=new r.SpotLight(l,r.Vector3.Zero(),r.Vector3.Backward(),0,1,e._loader.babylonScene);c.angle=2*(t.spot&&t.spot.outerConeAngle||Math.PI/4);c.innerAngle=2*(t.spot&&t.spot.innerConeAngle||0);h=c;break;default:throw new Error(o+": Invalid light type ("+t.type+")");}h.falloffType=r.Light.FALLOFF_GLTF;h.diffuse=t.color?r.Color3.FromArray(t.color):r.Color3.White();h.intensity=null==t.intensity?1:t.intensity;h.range=null==t.range?Number.MAX_VALUE:t.range;h.parent=n;u.b.AddPointerMetadata(h,o);i(n)})})},n}();u.b.RegisterExtension(s,function(n){return new h(n)});c="KHR_materials_pbrSpecularGlossiness";l=function(){function n(n){this.name=c;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader},n.prototype.loadMaterialPropertiesAsync=function(n,t,i){var r=this;return u.b.LoadExtensionAsync(n,t,this.name,function(u,f){var e=[];return e.push(r._loader.loadMaterialBasePropertiesAsync(n,t,i)),e.push(r._loadSpecularGlossinessPropertiesAsync(u,t,f,i)),r._loader.loadMaterialAlphaProperties(n,t,i),Promise.all(e).then(function(){})})},n.prototype._loadSpecularGlossinessPropertiesAsync=function(n,t,i,u){if(!(u instanceof r.PBRMaterial))throw new Error(n+": Material type not supported");var f=[];return u.metallic=null,u.roughness=null,i.diffuseFactor?(u.albedoColor=r.Color3.FromArray(i.diffuseFactor),u.alpha=i.diffuseFactor[3]):u.albedoColor=r.Color3.White(),u.reflectivityColor=i.specularFactor?r.Color3.FromArray(i.specularFactor):r.Color3.White(),u.microSurface=null==i.glossinessFactor?1:i.glossinessFactor,i.diffuseTexture&&f.push(this._loader.loadTextureInfoAsync(n+"/diffuseTexture",i.diffuseTexture,function(n){n.name=u.name+" (Diffuse)";u.albedoTexture=n})),i.specularGlossinessTexture&&(f.push(this._loader.loadTextureInfoAsync(n+"/specularGlossinessTexture",i.specularGlossinessTexture,function(n){n.name=u.name+" (Specular Glossiness)";u.reflectivityTexture=n})),u.reflectivityTexture.hasAlpha=!0,u.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(f).then(function(){})},n}();u.b.RegisterExtension(c,function(n){return new l(n)});a="KHR_materials_unlit";v=function(){function n(n){this.name=a;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader},n.prototype.loadMaterialPropertiesAsync=function(n,t,i){var r=this;return u.b.LoadExtensionAsync(n,t,this.name,function(){return r._loadUnlitPropertiesAsync(n,t,i)})},n.prototype._loadUnlitPropertiesAsync=function(n,t,i){var f,u;if(!(i instanceof r.PBRMaterial))throw new Error(n+": Material type not supported");return f=[],i.unlit=!0,u=t.pbrMetallicRoughness,u&&(u.baseColorFactor?(i.albedoColor=r.Color3.FromArray(u.baseColorFactor),i.alpha=u.baseColorFactor[3]):i.albedoColor=r.Color3.White(),u.baseColorTexture&&f.push(this._loader.loadTextureInfoAsync(n+"/baseColorTexture",u.baseColorTexture,function(n){n.name=i.name+" (Base Color)";i.albedoTexture=n}))),t.doubleSided&&(i.backFaceCulling=!1,i.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(n,t,i),Promise.all(f).then(function(){})},n}();u.b.RegisterExtension(a,function(n){return new v(n)});y="KHR_texture_transform";p=function(){function n(n){this.name=y;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader},n.prototype.loadTextureInfoAsync=function(n,t,i){var f=this;return u.b.LoadExtensionAsync(n,t,this.name,function(u,e){return f._loader.loadTextureInfoAsync(n,t,function(n){if(!(n instanceof r.Texture))throw new Error(u+": Texture type not supported");e.offset&&(n.uOffset=e.offset[0],n.vOffset=e.offset[1]);n.uRotationCenter=0;n.vRotationCenter=0;e.rotation&&(n.wAng=-e.rotation);e.scale&&(n.uScale=e.scale[0],n.vScale=e.scale[1]);null!=e.texCoord&&(n.coordinatesIndex=e.texCoord);i(n)})})},n}();u.b.RegisterExtension(y,function(n){return new p(n)});w="MSFT_audio_emitter";b=function(){function n(n){this.name=w;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader;delete this._clips;delete this._emitters},n.prototype.onLoading=function(){var n=this._loader.gltf.extensions,t;n&&n[this.name]&&(t=n[this.name],this._clips=t.clips,this._emitters=t.emitters,u.a.Assign(this._clips),u.a.Assign(this._emitters))},n.prototype.loadSceneAsync=function(n,t){var i=this;return u.b.LoadExtensionAsync(n,t,this.name,function(r,f){var s=[],o,h,c,e;for(s.push(i._loader.loadSceneAsync(n,t)),o=0,h=f.emitters;o<h.length;o++){if(c=h[o],e=u.a.Get(r+"/emitters",i._emitters,c),null!=e.refDistance||null!=e.maxDistance||null!=e.rolloffFactor||null!=e.distanceModel||null!=e.innerAngle||null!=e.outerAngle)throw new Error(r+": Direction or Distance properties are not allowed on emitters attached to a scene");s.push(i._loadEmitterAsync(r+"/emitters/"+e.index,e))}return Promise.all(s).then(function(){})})},n.prototype.loadNodeAsync=function(n,t,i){var f=this;return u.b.LoadExtensionAsync(n,t,this.name,function(n,e){var o=[];return f._loader.loadNodeAsync(n,t,function(t){for(var c=function(i){var e=u.a.Get(n+"/emitters",f._emitters,i);o.push(f._loadEmitterAsync(n+"/emitters/"+e.index,e).then(function(){for(var i,n=0,u=e._babylonSounds;n<u.length;n++)i=u[n],i.attachToMesh(t),null==e.innerAngle&&null==e.outerAngle||(i.setLocalDirectionToMesh(r.Vector3.Forward()),i.setDirectionalCone(2*r.Tools.ToDegrees(null==e.innerAngle?Math.PI:e.innerAngle),2*r.Tools.ToDegrees(null==e.outerAngle?Math.PI:e.outerAngle),0))}))},s=0,h=e.emitters;s<h.length;s++)c(h[s]);i(t)}).then(function(n){return Promise.all(o).then(function(){return n})})})},n.prototype.loadAnimationAsync=function(n,t){var i=this;return u.b.LoadExtensionAsync(n,t,this.name,function(r,f){return i._loader.loadAnimationAsync(n,t).then(function(e){var c=[],o,s,h;for(u.a.Assign(f.events),o=0,s=f.events;o<s.length;o++)h=s[o],c.push(i._loadAnimationEventAsync(r+"/events/"+h.index,n,t,h,e));return Promise.all(c).then(function(){return e})})})},n.prototype._loadClipAsync=function(n,t){var i,r;return t._objectURL?t._objectURL:(t.uri?i=this._loader.loadUriAsync(n,t,t.uri):(r=u.a.Get(n+"/bufferView",this._loader.gltf.bufferViews,t.bufferView),i=this._loader.loadBufferViewAsync("#/bufferViews/"+r.index,r)),t._objectURL=i.then(function(n){return URL.createObjectURL(new Blob([n],{type:t.mimeType}))}),t._objectURL)},n.prototype._loadEmitterAsync=function(n,t){var s=this,o;if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){for(var e=[],h=t.name||"emitter"+t.index,c={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume},l=function(n){var f="#/extensions/"+i.name+"/clips",o=u.a.Get(f,i._clips,t.clips[n].clip);e.push(i._loadClipAsync(f+"/"+t.clips[n].clip,o).then(function(i){var u=t._babylonSounds[n]=new r.Sound(h,i,s._loader.babylonScene,null,c);u.refDistance=t.refDistance||1;u.maxDistance=t.maxDistance||256;u.rolloffFactor=t.rolloffFactor||1;u.distanceModel=t.distanceModel||"exponential";u._positionInEmitterSpace=!0}))},i=this,f=0;f<t.clips.length;f++)l(f);o=Promise.all(e).then(function(){var i=t.clips.map(function(n){return n.weight||1}),n=new r.WeightedSound(t.loop||!1,t._babylonSounds,i);t.innerAngle&&(n.directionalConeInnerAngle=2*r.Tools.ToDegrees(t.innerAngle));t.outerAngle&&(n.directionalConeOuterAngle=2*r.Tools.ToDegrees(t.outerAngle));t.volume&&(n.volume=t.volume);t._babylonData.sound=n});t._babylonData={loaded:o}}return t._babylonData.loaded},n.prototype._getEventAction=function(n,t,i,r,u){switch(i){case"play":return function(n){var i=(u||0)+(n-r);t.play(i)};case"stop":return function(){t.stop()};case"pause":return function(){t.pause()};default:throw new Error(n+": Unsupported action "+i);}},n.prototype._loadAnimationEventAsync=function(n,t,i,f,e){var s=this;if(0==e.targetedAnimations.length)return Promise.resolve();var h=e.targetedAnimations[0],c=f.emitter,o=u.a.Get("#/extensions/"+this.name+"/emitters",this._emitters,c);return this._loadEmitterAsync(n,o).then(function(){var t=o._babylonData.sound,i;t&&(i=new r.AnimationEvent(f.time,s._getEventAction(n,t,f.action,f.time,f.startOffset)),h.animation.addEvent(i),e.onAnimationGroupEndObservable.add(function(){t.stop()}),e.onAnimationGroupPauseObservable.add(function(){t.pause()}))})},n}();u.b.RegisterExtension(w,function(n){return new b(n)});k="MSFT_lod";d=function(){function n(n){this.name=k;this.enabled=!0;this.maxLODsToLoad=Number.MAX_VALUE;this.onNodeLODsLoadedObservable=new r.Observable;this.onMaterialLODsLoadedObservable=new r.Observable;this._nodeIndexLOD=null;this._nodeSignalLODs=[];this._nodePromiseLODs=[];this._materialIndexLOD=null;this._materialSignalLODs=[];this._materialPromiseLODs=[];this._loader=n}return n.prototype.dispose=function(){delete this._loader;this._nodeIndexLOD=null;this._nodeSignalLODs.length=0;this._nodePromiseLODs.length=0;this._materialIndexLOD=null;this._materialSignalLODs.length=0;this._materialPromiseLODs.length=0;this.onMaterialLODsLoadedObservable.clear();this.onNodeLODsLoadedObservable.clear()},n.prototype.onReady=function(){for(var u,i,n=this,f=function(t){var i=Promise.all(r._nodePromiseLODs[t]).then(function(){0!==t&&n._loader.endPerformanceCounter("Node LOD "+t);n._loader.log("Loaded node LOD "+t);n.onNodeLODsLoadedObservable.notifyObservers(t);t!==n._nodePromiseLODs.length-1&&(n._loader.startPerformanceCounter("Node LOD "+(t+1)),n._nodeSignalLODs[t]&&n._nodeSignalLODs[t].resolve())});r._loader._completePromises.push(i)},r=this,t=0;t<this._nodePromiseLODs.length;t++)f(t);for(u=function(t){var r=Promise.all(i._materialPromiseLODs[t]).then(function(){0!==t&&n._loader.endPerformanceCounter("Material LOD "+t);n._loader.log("Loaded material LOD "+t);n.onMaterialLODsLoadedObservable.notifyObservers(t);t!==n._materialPromiseLODs.length-1&&(n._loader.startPerformanceCounter("Material LOD "+(t+1)),n._materialSignalLODs[t]&&n._materialSignalLODs[t].resolve())});i._loader._completePromises.push(r)},i=this,t=0;t<this._materialPromiseLODs.length;t++)u(t)},n.prototype.loadNodeAsync=function(n,t){var i=this;return u.b.LoadExtensionAsync(n,t,this.name,function(n,u){var o,e=i._getLODs(n,t,i._loader.gltf.nodes,u.ids),s,f;for(i._loader.logOpen(""+n),s=function(n){var u=e[n],t;0!==n&&(i._nodeIndexLOD=n,i._nodeSignalLODs[n]=i._nodeSignalLODs[n]||new r.Deferred);t=i._loader.loadNodeAsync("#/nodes/"+u.index,u,function(n){n.setEnabled(!1)}).then(function(t){if(0!==n){var r=e[n-1];r._babylonTransformNode&&(r._babylonTransformNode.dispose(),delete r._babylonTransformNode,i._disposeUnusedMaterials())}return t.setEnabled(!0),t});0===n?o=t:i._nodeIndexLOD=null;i._nodePromiseLODs[n]=i._nodePromiseLODs[n]||[];i._nodePromiseLODs[n].push(t)},f=0;f<e.length;f++)s(f);return i._loader.logClose(),o})},n.prototype._loadMaterialAsync=function(n,t,i,r,f){var e=this;return this._nodeIndexLOD?null:u.b.LoadExtensionAsync(n,t,this.name,function(n,u){var h,s=e._getLODs(n,t,e._loader.gltf.materials,u.ids),c,o;for(e._loader.logOpen(""+n),c=function(n){var u=s[n],t;0!==n&&(e._materialIndexLOD=n);t=e._loader._loadMaterialAsync("#/materials/"+u.index,u,i,r,function(t){0===n&&f(t)}).then(function(t){if(0!==n){f(t);var i=s[n-1]._data;i[r]&&(i[r].babylonMaterial.dispose(),delete i[r])}return t});0===n?h=t:e._materialIndexLOD=null;e._materialPromiseLODs[n]=e._materialPromiseLODs[n]||[];e._materialPromiseLODs[n].push(t)},o=0;o<s.length;o++)c(o);return e._loader.logClose(),h})},n.prototype._loadUriAsync=function(n,t,i){var f=this,u;return null!==this._materialIndexLOD?(this._loader.log("deferred"),u=this._materialIndexLOD-1,this._materialSignalLODs[u]=this._materialSignalLODs[u]||new r.Deferred,this._materialSignalLODs[u].promise.then(function(){return f._loader.loadUriAsync(n,t,i)})):null!==this._nodeIndexLOD?(this._loader.log("deferred"),u=this._nodeIndexLOD-1,this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new r.Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return f._loader.loadUriAsync(n,t,i)})):null},n.prototype._getLODs=function(n,t,i,r){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var f=[],e=r.length-1;e>=0;e--)if(f.push(u.a.Get(n+"/ids/"+r[e],i,r[e])),f.length===this.maxLODsToLoad)return f;return f.push(t),f},n.prototype._disposeUnusedMaterials=function(){var f=this._loader.gltf.materials,t,i,n,r,u;if(f)for(t=0,i=f;t<i.length;t++)if(n=i[t],n._data)for(r in n._data)u=n._data[r],0===u.babylonMeshes.length&&(u.babylonMaterial.dispose(!1,!0),delete n._data[r])},n}();u.b.RegisterExtension(k,function(n){return new d(n)});g="MSFT_minecraftMesh";nt=function(){function n(n){this.name=g;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader},n.prototype.loadMaterialPropertiesAsync=function(n,t,i){var f=this;return u.b.LoadExtraAsync(n,t,this.name,function(u,e){if(e){if(!(i instanceof r.PBRMaterial))throw new Error(u+": Material type not supported");var o=f._loader.loadMaterialPropertiesAsync(n,t,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.backFaceCulling=i.forceDepthWrite,i.twoSidedLighting=!0,o}return null})},n}();u.b.RegisterExtension(g,function(n){return new nt(n)});tt="MSFT_sRGBFactors";it=function(){function n(n){this.name=tt;this.enabled=!0;this._loader=n}return n.prototype.dispose=function(){delete this._loader},n.prototype.loadMaterialPropertiesAsync=function(n,t,i){var f=this;return u.b.LoadExtraAsync(n,t,this.name,function(u,e){if(e){if(!(i instanceof r.PBRMaterial))throw new Error(u+": Material type not supported");var o=f._loader.loadMaterialPropertiesAsync(n,t,i);return i.albedoTexture||i.albedoColor.toLinearSpaceToRef(i.albedoColor),i.reflectivityTexture||i.reflectivityColor.toLinearSpaceToRef(i.reflectivityColor),o}return null})},n}();u.b.RegisterExtension(tt,function(n){return new it(n)});i.d(t,"EXT_lights_image_based",function(){return ut});i.d(t,"KHR_draco_mesh_compression",function(){return o});i.d(t,"KHR_lights",function(){return h});i.d(t,"KHR_materials_pbrSpecularGlossiness",function(){return l});i.d(t,"KHR_materials_unlit",function(){return v});i.d(t,"KHR_texture_transform",function(){return p});i.d(t,"MSFT_audio_emitter",function(){return b});i.d(t,"MSFT_lod",function(){return d});i.d(t,"MSFT_minecraftMesh",function(){return nt});i.d(t,"MSFT_sRGBFactors",function(){return it})},function(n,t,i){"use strict";var u,r;i.r(t);u=i(1);i.d(t,"ArrayItem",function(){return u.a});i.d(t,"GLTFLoader",function(){return u.b});r=i(4);i.d(t,"EXT_lights_image_based",function(){return r.EXT_lights_image_based});i.d(t,"KHR_draco_mesh_compression",function(){return r.KHR_draco_mesh_compression});i.d(t,"KHR_lights",function(){return r.KHR_lights});i.d(t,"KHR_materials_pbrSpecularGlossiness",function(){return r.KHR_materials_pbrSpecularGlossiness});i.d(t,"KHR_materials_unlit",function(){return r.KHR_materials_unlit});i.d(t,"KHR_texture_transform",function(){return r.KHR_texture_transform});i.d(t,"MSFT_audio_emitter",function(){return r.MSFT_audio_emitter});i.d(t,"MSFT_lod",function(){return r.MSFT_lod});i.d(t,"MSFT_minecraftMesh",function(){return r.MSFT_minecraftMesh});i.d(t,"MSFT_sRGBFactors",function(){return r.MSFT_sRGBFactors})},,,,function(n,t,i){"use strict";(function(n){var r=i(2),u,f;if(i.d(t,"a",function(){return r.GLTFFileLoader}),i.d(t,"b",function(){return r.GLTFLoaderAnimationStartMode}),i.d(t,"c",function(){return r.GLTFLoaderCoordinateSystemMode}),i.d(t,"d",function(){return r.GLTFLoaderState}),u=void 0!==n?n:"undefined"!=typeof window?window:void 0,void 0!==u)for(f in u.BABYLON=u.BABYLON||{},r)u.BABYLON[f]=r[f]}).call(this,i(3))},function(){},,function(n,t,i){"use strict";(function(n){var s=i(4),h=i(10),o=i(5),f,u,e,r;if(i.d(t,"a",function(){return o}),f=void 0!==n?n:"undefined"!=typeof window?window:void 0,void 0!==f){f.BABYLON=f.BABYLON||{};u=f.BABYLON;u.GLTF2=u.GLTF2||{};u.GLTF2.Loader=u.GLTF2.Loader||{};u.GLTF2.Loader.Extensions=u.GLTF2.Loader.Extensions||{};e=[];for(r in s)u.GLTF2.Loader.Extensions[r]=s[r],e.push(r);for(r in h)u.GLTF2.Loader[r]=h[r],e.push(r);for(r in o)e.indexOf(r)>-1||(u.GLTF2[r]=o[r])}}).call(this,i(3))},,,,function(n,t,i){"use strict";var r,u;i.r(t);r=i(9);i.d(t,"GLTFLoaderCoordinateSystemMode",function(){return r.c});i.d(t,"GLTFLoaderAnimationStartMode",function(){return r.b});i.d(t,"GLTFLoaderState",function(){return r.d});i.d(t,"GLTFFileLoader",function(){return r.a});u=i(12);i.d(t,"GLTF2",function(){return u.a})}])})